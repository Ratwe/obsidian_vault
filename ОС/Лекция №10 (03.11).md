Обратите внимание на второе свойство из [[Свойства транзакций]].

Свойство упорядоченности гарантирует, что если 2+ транзакции выполняются одновременно, то конечный результат должен выглядеть так, как если бы все транзакции выполнялись в заданном наперёд порядке.

Транзакции имеют неприятное свойство попадать в тупики.

# [[Тупики]]
- P1 запрашивает ресурс R1, а P2 - R2
- Оба получили по ресурсу
- P1 запрашивает R2, а P2 - R1
- Тупик

Это картинка называется круговым ожиданием.
![[IMG_20231103_155817_570.jpg]]

***Тупиковая ситуация (тупик)*** - ситуация, возникающая в результате монопольного использования разделяемых ресурсов, когда процесс, владея ресурсом, запрашивает другой ресурс, занятый непосредственно или через цепочку запросов другим процессом, ожидающим высвобождением ресурса, занятым первым ресурсом.

В теории тупиков принято различать два типа ресурсов. 
- потребляемые ресурсы (сообщения). 
  Характерно, что такой ресурс перестаёт существовать при его потреблении.
- повторно используемые (все элементы аппаратной составляющей системы, реинтерабельный коды самой ОС, системные таблицы, объекты ядра). Семафоры, сегменты разделяемой памяти рассматривают как объекты.

Свойства повторно используемых ресурсов:
- число единиц повторно используемых ресурсов ограничено

Короче говоря, вся теория тупиков строится на повторно используемых ресурсах.

Четыре условия (необходимые и достаточные) для тупика.
1. Mutual exсlusion - когда процессы монопольно используют предоставленные им ресурсы.
2. Ожидания (hold and wait). ...ожидая доп ресурсов для продолжения.
3. Неперераспределяемость - ресурсы нельзя отобрать у процесса до его завершения или освобождения их самим процессом.
4. Круговое ожидание (circle wait), когда существует замкнутая цепь запросов процессов, в которой каждый процесс запрашивает необходимые ресурсы, которые нужны другому процессу.

## [[Методы борьбы с тупиками]]
Три основных подхода:
1. Недопущение тупиков. 
2. Обход тупиков.
3. Тупики возможны. Система попадает в тупик, и тогда необходимо обнаружить, что она попала в тупик, а после обнаружения необходимо восстановить работоспособность системы (система взаимодействия процессов).

Тупик не возникнет, если будет исключено хотя бы одно условие возникновения тупиковой ситуации.

Что-то там системы реального времени, предназначенные для управления внешними системами и процессами.

Ярчайший пример такой системы: автопилот.

### Недопущение тупиков
1. Опережающее требование. Процесс заранее запрашивает все необходимые ресурсы, *используемые в* процессе выполнения. Исключаетhold and wait. Вариант оптимизации - разделение на подзадачи.
2. ... исключает круговое ожидание.
3. Устранение условий нерераспределяемости ресурсов. Если процесс не может получить нужный ему ресурс, то у него нужно отобрать ресурсы, которые он занимает. Может привести к тому, что процессы многократно запрашивают одни и те же ресурсы.

### Обход тупиков
#### Алгоритм Банкира
Заёмщики - процессы, которые запрашивают ресурсы.

Банкир - система, анализирующая запросы процессов.

В этой системе существуют ограничения:
- процессы должны указать в заявке (claim) свою максимальную потребность в каждом ресурсе.
- кол-во процессов в системе известно и ограничено.
- процесс не может запросить больше единиц ресурса, чем указано в его заявке.

Запомните, твари: **процессы создаются по мере необходимости, а ресурсы выдаются по мере надобности.**

В заявке не может быть больше ресурсов, чем есть в системе.

Формально: состояние системы является безопасным, если существует последовательность процессов такая, что:
- первый найденный в последовательности процесс успешно завершится, тк даже если он запросит макс. заявленное кол-во единиц ресурса, у системы имеется необходимое кол-во свободных единиц ресурса для удовлетворения этого запроса.
- второй процесс в послед-ти может завершиться, если завершился первый и вернул системе все занимаемыеим ед. ресурса. Что в сумме со свободными позволит удовлетворить макс. потребность второго процесса и т.д.
- i-й процесс может завершиться, если i-1 процессы завершатся и вернут системе занимаемые ими ед. ресурса. Что позволить удовлетворить потребность i-го процесса в ресурсе.

Необходимо исследовать n! послед-ей прежде чем оценить не/безопасность системы. Поэтому алгоритм Банкира имеет неоспоримое теоретическое значение. Но практическая реализация затруднена.

#### Алгоритм Хабермана
Обобщение алгоритма Дейкстры (Банкира).

### Zero-links
[[00 ОС]]